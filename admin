<?php
require "config.php";
session_start();
date_default_timezone_set("Asia/Jakarta");

// Memeriksa user logout atau belum login
if(!isset($_SESSION["login"]) || isset($_GET["logout"])) {
    session_destroy();
    echo"
    <script>
        document.location.href = 'login.php';
    </script>";
}

$user_id = $_SESSION["login"];
$user = findOne("SELECT * FROM user WHERE id = '$user_id'");

// Relasi antara tabel user dan post
$posts = findAll("SELECT u., p. FROM post p INNER JOIN user u WHERE p.user_id=u.id ORDER BY created_at DESC");

// Memeriksa method post yang dikirim ke halaman ini
if(isset($_POST["post"])) {
    $content = $_POST["content"];
    $created_at = date("Y-m-d H:i:s");

    $create_post = commit("INSERT INTO post SET user_id='$user_id', content='$content', created_at='$created_at'");
    if($create_post < 0) {
        echo"
        <script>
            alert('Post gagal dikirim');
            document.location.href = 'index.php';
        </script>";
    }
    echo"
    <script>
        document.location.href = 'index.php';
    </script>";
}
?>
